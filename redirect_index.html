<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Open Apex Mobile</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f0f4ff;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .card {
      background: white;
      border-radius: 20px;
      padding: 40px 28px;
      max-width: 360px;
      width: 90%;
      text-align: center;
      box-shadow: 0 8px 32px rgba(35, 91, 186, 0.12);
    }

    .logo {
      width: 72px;
      height: 72px;
      background: #235BBA;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 36px;
    }

    h1 { font-size: 22px; color: #1a1a2e; margin-bottom: 8px; }

    .hospital-name {
      font-size: 17px;
      color: #235BBA;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 14px;
      color: #888;
      margin-bottom: 32px;
    }

    /* â”€â”€ Main CTA button â€” this IS the user gesture Chrome requires â”€â”€ */
    .btn-main {
      display: block;
      background: #235BBA;
      color: white;
      padding: 16px;
      border-radius: 14px;
      text-decoration: none;
      font-weight: 700;
      font-size: 17px;
      margin-bottom: 14px;
      border: none;
      width: 100%;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-main:active { background: #1a4a9e; }

    .hint {
      font-size: 12px;
      color: #bbb;
      margin-top: 20px;
      line-height: 1.6;
    }
  </style>
</head>
<body>

<div class="card">
  <div class="logo">ğŸ¥</div>
  <h1>Check-in Required</h1>
  <p class="hospital-name" id="hospitalLabel">Loading...</p>
  <p class="subtitle">You're near this hospital. Tap below to open the Apex Mobile app and record your visit.</p>

  <!--
    KEY FIX: Chrome requires a real user tap (gesture) to open apps.
    The href uses the Chrome intent format for Android,
    which works in Chrome AND falls back gracefully if app not found.
    The button tap IS the user gesture â€” no setTimeout needed.
  -->
  <a class="btn-main" id="openBtn" href="#">
    Open Apex Mobile App
  </a>

  <p class="hint">
    Make sure the Apex Mobile app is installed.<br/>
    The app will open automatically when you tap above.
  </p>
</div>

<script>
  // â”€â”€ Hospital name map (keep in sync with Flutter _availableHospitals) â”€â”€â”€â”€â”€
  const hospitalNames = {
    'ridge_hospital' : 'Ridge Hospital',
    'korle_bu'       : 'Korle Bu Teaching Hospital',
    '37_military'    : '37 Military Hospital',
    'nyaho_clinic'   : 'Nyaho Medical Centre',
    'tema_general'   : 'Tema General Hospital',
    'lekma_hospital' : 'Lekma Hospital',
  };

  // â”€â”€ Read hospital from URL param â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const params     = new URLSearchParams(window.location.search);
  const hospitalId = params.get('hospital') || 'ridge_hospital';
  const name       = hospitalNames[hospitalId] || 'the hospital';

  document.getElementById('hospitalLabel').textContent = name;

  // â”€â”€ YOUR PACKAGE NAME â€” change this to match your Flutter app â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Find it in: android/app/build.gradle â†’ applicationId
  // e.g.  "com.apex.apexmobile"  or  "com.example.apexmobile"
  const packageName = 'com.example.apexmobile'; // â† CHANGE THIS

  // â”€â”€ Detect browser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const isAndroid = /android/i.test(navigator.userAgent);
  const isIOS     = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isChrome  = /chrome/i.test(navigator.userAgent) && !/edg/i.test(navigator.userAgent);

  // â”€â”€ Build the correct deep link for each platform/browser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildLink() {
    if (isAndroid && isChrome) {
      // âœ… Chrome on Android requires the intent:// format â€” NOT apexmobile://
      // This is the ONLY format Chrome on Android accepts
      // S.browser_fallback_url = where to go if app not installed
      const fallback = encodeURIComponent('https://play.google.com/store');
      return `intent://checkin?hospital=${hospitalId}#Intent;scheme=apexmobile;package=${packageName};S.browser_fallback_url=${fallback};end`;

    } else if (isAndroid) {
      // Other Android browsers (Firefox, Samsung) â€” plain custom scheme works
      return `apexmobile://checkin?hospital=${hospitalId}`;

    } else if (isIOS) {
      // iOS Safari â€” plain custom scheme works
      return `apexmobile://checkin?hospital=${hospitalId}`;

    } else {
      // Desktop or unknown â€” just use plain scheme
      return `apexmobile://checkin?hospital=${hospitalId}`;
    }
  }

  // â”€â”€ Set the button href â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // The user TAPPING this link is the "user gesture" Chrome requires
  document.getElementById('openBtn').href = buildLink();
</script>

</body>
</html>